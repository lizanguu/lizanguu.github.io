<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Memory Heap</title><link rel="stylesheet" href="http://obfnm2kw5.bkt.clouddn.com/normalize.css"><link rel="stylesheet" href="/css/hexo-theme-adoubi.css"><link rel="icon" href="/images/favicon.ico"></head><body><div class="header"><a class="github-link"><img class="github-image" src="http://obfnm2kw5.bkt.clouddn.com/Aquicon-Github-small.png"></a><a class="email-link" href="mailto:null"><img class="email-image" src="http://obfnm2kw5.bkt.clouddn.com/email-small.png"></a><a class="subscribe-link" href="/atom.xml"><img class="subscribe-image" src="http://obfnm2kw5.bkt.clouddn.com/subscribe-small.png"></a></div><div class="content"><div class="post-item"></div><h2 class="post-title-wrapper"><p class="post-title">Memory Heap</p></h2><div class="post-date"><time datetime="2017-08-02T17:11:16.000Z">2017-08-03</time></div><div class="post-content"><p>仿nginx内存池的实现</p>
<h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><h3 id="内存块"><a href="#内存块" class="headerlink" title="内存块"></a>内存块</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">typedef struct ltk_heap_block &#123;</div><div class="line">	char *last;</div><div class="line">	char *end;</div><div class="line">	ltk_heap_t *next;</div><div class="line">&#125; ltk_heap_block_t;</div></pre></td></tr></table></figure>
<h3 id="大内存块"><a href="#大内存块" class="headerlink" title="大内存块"></a>大内存块</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">typedef struct ltk_heap_large &#123;</div><div class="line">	void *alloc;</div><div class="line">	ltk_heap_large_t *next;</div><div class="line">&#125; ltk_heap_large_t;</div></pre></td></tr></table></figure>
<h3 id="清理"><a href="#清理" class="headerlink" title="清理"></a>清理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">typedef struct ltk_heap_cleanup &#123;</div><div class="line">	ltk_heap_cleanup_pt handler;</div><div class="line">	void *data;</div><div class="line">	ltk_heap_cleanup_t *next;</div><div class="line">&#125; ltk_heap_cleanup_t;</div></pre></td></tr></table></figure>
<h3 id="内存池"><a href="#内存池" class="headerlink" title="内存池"></a>内存池</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">typedef struct ltk_heap &#123;</div><div class="line">	size_t max;</div><div class="line">	ltk_heap_block_t block;</div><div class="line">	ltk_heap_t *current;</div><div class="line">	ltk_heap_large_t *large;</div><div class="line">	ltk_heap_cleanup_t *cleanup;</div><div class="line">&#125;ltk_heap_t;</div></pre></td></tr></table></figure>
<h2 id="内存操作"><a href="#内存操作" class="headerlink" title="内存操作"></a>内存操作</h2><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2></div></div><div class="footer"><div class="footer-copyright">Theme By <a href="https://github.com/shinux/hexo-theme-adoubi">Adoubi</a> , Powered By Hexo.</div></div></body></html>